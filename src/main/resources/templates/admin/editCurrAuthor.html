<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SIW - Modifica Autore</title>
	<link rel="stylesheet" href="/css/stile.css" />
</head>

<body>
	<div th:replace="~{fragments.html :: siteHeader}"></div>
	<div class="main-container">

		<div th:if="${currAuthor and #authorization.expression('hasAuthority(''ADMIN'')')}">

			<!-- Info autore -->
			<form th:action="@{'/admin/editAuthor/' + ${currAuthor.id} + '/update'}" method="post">
				<label for="name">Nome:</label>
				<input type="text" name="name" th:value="${currAuthor.name}" required />
				<br><br>
				<label for="surname">Cognome:</label>
				<input type="text" name="surname" th:value="${currAuthor.surname}" required />
				<br><br>
				<label for="nationality">Nazionalità:</label>
				<input type="text" name="nationality" th:value="${currAuthor.nationality}" />
				<br><br>
				<label for="dateOfBirth">Data di nascita:</label>
				<input type="date" name="dateOfBirth" th:value="${currAuthor.dateOfBirth}" required />
				<br><br>
				<label for="dateOfDeath">Data di morte:</label>
				<input type="date" name="dateOfDeath" th:value="${currAuthor.dateOfDeath}" />
				<br><br><br>
				<button class="btn" type="submit">Salva modifiche</button>
			</form>

			<!-- Foto autore -->
			<div th:if="${currAuthor.picture!=null}">
				<img class="book-cover" th:src="@{'/image/' + ${currAuthor.image.id}}" alt="Foto autore" />

				<form
					th:action="@{'/admin/editAuthors/' + ${currAuthor.id} + '/image/' + ${currAuthor.image.id} + '/delete'}"
					method="post">
					<button class="btn-danger" type="submit">Conferma</button>
				</form>
			</div>
			<div th:unless="${currAuthor.picture!=null}">
				<form th:action="@{'/admin/editAuthors/' + ${currAuthor.id} + '/image'}" method="post"
					enctype="multipart/form-data"> <label>Carica foto:</label>
					<input type="file" name="imageFile" accept="image/*" onchange="this.form.submit()" />
				</form>
			</div>

			<!-- Elenco libri -->
			<div>
				<h2>Libri pubblicati:</h2>
				<ul class="book-list">
					<li th:each="b : ${currAuthor.books}">
						<a th:href="@{'/admin/editBooks/' + ${b.id}}" class="book-item">
							<img class="book-cover" th:if="${b.images!=null and !b.images.empty}"
								alt="Copertina libro" />
							<div class="book-details">
								<span class="book-title" th:text="${b.title}">Titolo</span>
								<span class="book-meta"
									th:text="${b.authors==null or b.authors.empty ? b.releaseYear : b.authors[0].name + ' ' + b.authors[0].surname + ', ' + b.releaseYear}">
									Nome Cognome, 2000</span>

								<form
									th:action="@{'/admin/editAuthors/' + ${currAuthor.id} + '/deleteBooks/' + ${b.id}}"
									method="post"> <button class="btn-danger" type="submit">Rimuovi</button>
							</div>
						</a>
					</li>

					<form th:action="@{'/admin/editAuthors/' + ${currAuthor.id} + '/addBooks'}" method="post">
						<button class="btn" type="submit">Aggiungi libro</button>
					</form>
				</ul>
			</div>

			<!-- Messaggio se l'autore non esiste -->
		</div>
		<h2 th:unless="${currAuthor}">L'autore non è presente nel sistema.</h2>
		<h2 th:unless="${#authorization.expression('hasAuthority(''ADMIN'')')}">
			Solo un amministratore può modificare questo libro.</h2>

	</div>
</body>

</html>